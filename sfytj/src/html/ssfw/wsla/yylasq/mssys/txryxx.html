<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
            <meta content="IE=edge" http-equiv="X-UA-Compatible">
                <meta content="width=device-width, initial-scale=1" name="viewport">
                    <title>
                        填写人员信息
                    </title>
                    <link href="/sfytj/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
                    <link href="/sfytj/dist/styles/main.min.css" rel="stylesheet" type="text/css"/>
                    <script event="IDCardOn" for="GGIDCard" language="JavaScript">
                        close_IDCard();
                        var card_data = {
                            "name": GGIDCard.Name,
                            "identity_card": GGIDCard.IDCode,
                            "nationality": GGIDCard.Nation,
                            "gender": GGIDCard.Sex,
                            "country": "09_00004-1",
                            "address": GGIDCard.Address,
                        }
                        get_txryxx(card_data);
                    </script>
                </meta>
            </meta>
        </meta>
    </head>
    <!-- 填写人员信息 新版界面 -->
    <body onunload="close_light(4)">
        <!-- 身份证 -->
        <object classid="CLSID:A84304A7-959F-41CF-BF48-866865BF68F0" height="252" id="GGIDCard" name="GGIDCard" style="display:none;" width="204">
        </object>
        <div class="txryxx">
            <div class="wrap">
                <div class="common_body">
                    <!--导航条部分-->
                    <div class="ssfw_nav yylasq_nav clearfix">
                        <!--自助立案标题 -->
                        <div class="nav_title">
                            <h2>
                                自助立案
                            </h2>
                        </div>
                        <!--进度条 -->
                        <div class="nav_process">
                            <!-- 圆点和横线 -->
                            <div class="process clearfix">
                                <div class="process1">
                                    <div class="nav_line1">
                                    </div>
                                    <a href="javascript:void(0);" onclick="url_load('xzfy.html')">
                                        <div class="nav_circle">
                                            1
                                        </div>
                                    </a>
                                </div>
                                <div class="process2">
                                    <div class="nav_line">
                                    </div>
                                    <a href="javascript:void(0);" onclick="url_load('txaj.html')">
                                        <div class="nav_circle">
                                            2
                                        </div>
                                    </a>
                                </div>
                                <div class="process3">
                                    <div class="nav_line">
                                    </div>
                                    <a href="javascript:void(0);" onclick="url_load('txryxx.html')">
                                        <div class="nav_circle">
                                            3
                                        </div>
                                    </a>
                                </div>
                                <div class="process4">
                                    <div class="nav_line">
                                    </div>
                                    <a href="javascript:void(0);" onclick="url_load('txdlr.html')">
                                        <div class="nav_circle">
                                            4
                                        </div>
                                    </a>
                                </div>
                                <div class="process5">
                                    <div class="nav_line">
                                    </div>
                                    <a href="javascript:void(0);" onclick="url_load('tjcl.html')">
                                        <div class="nav_circle">
                                            5
                                        </div>
                                    </a>
                                </div>
                                <div class="process6">
                                    <div class="nav_line">
                                    </div>
                                    <a href="javascript:void(0);" onclick="url_load('yylaqrb.html')">
                                        <div class="nav_circle">
                                            6
                                        </div>
                                    </a>
                                </div>
                            </div>
                            <!-- 下方的文字 -->
                            <div class="process_title clearfix">
                                <div class="process_titleinfo">
                                    选择法院
                                </div>
                                <div class="process_titleinfo">
                                    案件信息
                                </div>
                                <div class="process_titleinfo">
                                    当事人信息
                                </div>
                                <div class="process_titleinfo">
                                    代理人信息
                                </div>
                                <div class="process_titleinfo">
                                    提交材料
                                </div>
                                <div class="process_titleinfo">
                                    信息确认
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--页面主要内容-->
                    <div class="txryxx_content row clearfix">
                        <div class="col-md-12 column">
                            <div class="panel-group" id="panel-847609">
                                <!--原告-->
                                <div class="panel panel-default yg_panel active_panel" id="yg_table">
                                    <div class="panel-title font_h2 collapsed" data-parent="#panel-847609" data-target="#panel-element-493796" data-toggle="collapse" onclick="change_panel('yg_panel', 'mssys')" value="原告">
                                        <div class="panel-heading font_h1">
                                            原告
                                            <div class="title_line">
                                            </div>
                                            <span class="badge">
                                            </span>
                                        </div>
                                    </div>
                                    <div class="panel-collapse collapse in" id="panel-element-493796">
                                        <div class="panel-body clearfix">
                                            <div class="body_line">
                                            </div>
                                            <!--已添加原告-->
                                            <div class="yg_list people_list fl">
                                                <div class="list_title font_bigger center-block">
                                                    已经添加的原告列表
                                                </div>
                                                <div class="list_content font_bigger">
                                                </div>
                                            </div>
                                            <!--填写信息-->
                                            <div class="input_list fr">
                                                <div class="input_form">
                                                    <form class="form-horizontal font_bigger" id="type_1">
                                                        <!--选择添加原告类型-->
                                                        <div class="choose_type clearfix">
                                                            <div class="form-group col-sm-6 ">
                                                                <label class="col-sm-5 control-label font_bigger required" for="inputT_yg">
                                                                    选择类型
                                                                </label>
                                                                <div class="col-sm-7">
                                                                    <select class="form-control input_type input_person_type hight font_bigger" id="inputT_yg" onchange="show_input_tab()" placeholder="">
                                                                        <option value="09_01001-1">
                                                                            自然人
                                                                        </option>
                                                                        <option value="09_01001-2">
                                                                            法人
                                                                        </option>
                                                                        <option value="09_01001-3">
                                                                            非法人
                                                                        </option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!--  输入内容区域 -->
                                                        <div class="input_list_content font_bigger">
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--被告-->
                                <div class="panel panel-default bg_panel" id="bg_table">
                                    <div class="panel-title font_h2 collapsed" data-parent="#panel-847609" data-target="#panel-element-291042" data-toggle="collapse" onclick="change_panel('bg_panel', 'mssys')" value="被告">
                                        <div class="panel-heading font_h1">
                                            被告
                                            <div class="title_line">
                                            </div>
                                            <span class="badge">
                                            </span>
                                        </div>
                                    </div>
                                    <div class="panel-collapse collapse" id="panel-element-291042">
                                        <div class="panel-body">
                                            <!--被告部分-->
                                            <div class="body_line">
                                            </div>
                                            <!--已添加被告-->
                                            <div class="yg_list people_list fl">
                                                <div class="list_title font_bigger center-block">
                                                    已经添加的被告列表
                                                </div>
                                                <div class="list_content font_bigger">
                                                </div>
                                            </div>
                                            <!--填写信息-->
                                            <div class="input_list fr">
                                                <div class="input_form">
                                                    <form class="form-horizontal font_bigger" id="type_2">
                                                        <!--选择添加被告类型-->
                                                        <div class="choose_type clearfix">
                                                            <div class="form-group col-sm-6 ">
                                                                <label class="col-sm-5 control-label font_bigger required" for="inputT_bg">
                                                                    选择类型
                                                                </label>
                                                                <div class="col-sm-7">
                                                                    <select class="form-control input_type input_person_type hight font_bigger" id="inputT_bg" onchange="show_input_tab()" placeholder="">
                                                                        <option value="09_01001-1">
                                                                            自然人
                                                                        </option>
                                                                        <option value="09_01001-2">
                                                                            法人
                                                                        </option>
                                                                        <option value="09_01001-3">
                                                                            非法人
                                                                        </option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!--  输入内容区域 -->
                                                        <div class="input_list_content font_bigger">
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--第三人-->
                                <div class="panel panel-default dsr_panel" id="dsr_table">
                                    <div class="panel-title font_h2 collapsed" data-parent="#panel-847609" data-target="#panel-element-291041" data-toggle="collapse" onclick="change_panel('dsr_panel', 'mssys')" value="第三人">
                                        <div class="panel-heading font_h1">
                                            第三人
                                            <div class="title_line">
                                            </div>
                                            <span class="badge">
                                            </span>
                                        </div>
                                    </div>
                                    <div class="panel-collapse collapse" id="panel-element-291041">
                                        <div class="panel-body ">
                                            <!--第三人部分-->
                                            <div class="body_line">
                                            </div>
                                            <!--已添加原告-->
                                            <div class="yg_list people_list fl">
                                                <div class="list_title font_bigger center-block">
                                                    已经添加的第三人
                                                </div>
                                                <div class="list_content font_bigger">
                                                </div>
                                            </div>
                                            <!--填写信息-->
                                            <div class="input_list fr">
                                                <div class="input_form">
                                                    <form class="form-horizontal font_bigger" id="type_3">
                                                        <!--选择添加原告类型-->
                                                        <div class="choose_type clearfix">
                                                            <div class="form-group col-sm-6 ">
                                                                <label class="col-sm-5 control-label font_bigger required" for="inputT_dsr">
                                                                    选择类型
                                                                </label>
                                                                <div class="col-sm-7">
                                                                    <select class="form-control input_type input_person_type hight font_bigger " id="inputT_dsr" onchange="show_input_tab()" placeholder="">
                                                                        <option value="09_01001-1">
                                                                            自然人
                                                                        </option>
                                                                        <option value="09_01001-2">
                                                                            法人
                                                                        </option>
                                                                        <option value="09_01001-3">
                                                                            非法人
                                                                        </option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!--  输入内容区域 -->
                                                        <div class="input_list_content font_bigger">
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--按钮-->
                    <div class=" btn_row">
                        <div>
                            <button class="rtn_btn fl common_btn" onclick="window.location.href='txaj.html'" type="submit">
                                上一步
                            </button>
                        </div>
                        <div class="zscg_btn">
                            <div>
                                <!-- 硬件调试用 -->
                                <button class="get_btn fl common_btn specious_btn function_btn" id="get_from_ID" onclick="txryxx_open_card()">
                                    刷身份证
                                </button>
                            </div>
                            <div>
                                <button class="fl common_btn function_btn" onclick="add_person_btn('mssys')">
                                    清除
                                </button>
                            </div>
                            <div>
                                <button class="savew_btn fl common_btn function_btn" onclick="add_person('mssys')" type="submit">
                                    保存
                                </button>
                            </div>
                            <div>
                                <button class="del_btn fl common_btn function_btn" onclick="delete_person('mssys')" style="display: none" type="submit">
                                    删除
                                </button>
                            </div>
                        </div>
                        <input class="next_btn fr common_btn " onclick="txryxx_nextstep()" type="button" value="下一步"/>
                    </div>
                </div>
            </div>
        </div>
        <div aria-labelledby="mySmallModalLabel" class="modal fade tip-modal" role="dialog" tabindex="-1">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                            <span aria-hidden="true">
                                ×
                            </span>
                        </button>
                        <h4 class="modal-title" id="mySmallModalLabel">
                            提示消息
                        </h4>
                    </div>
                    <div class="modal-body modal_style">
                    </div>
                </div>
            </div>
        </div>
        <script src="/sfytj/bower_components/jquery/dist/jquery.min.js" type="text/javascript">
        </script>
        <script src="/sfytj/dist/scripts/main.min.js" type="text/javascript">
        </script>
        <script src="/sfytj/bower_components/bootstrap/dist/js/bootstrap.min.js" type="text/javascript">
        </script>
        <OBJECT classid="clsid:18EE8930-6993-4ADA-B8BB-02BA5820AC94" id="aaa" style="display: none" CODEBASE="Termb.cab#version=1,0,0,1"  VIEWASTEXT></OBJECT>
        <script type="text/javascript">
        //循环读取律所机的身份证信息
           var handler;
            /*从身份证获取信息*/
            function txryxx_open_card() {
                var machine_type = JSON.parse(getCookie("sftyj_config")).mid || ""; 
                //律所机
                if (machine_type == 'S110') {
                  Close_Read_IDCard();
                  Read_IDCard_Comm();
                  handler = setInterval("Read_IDCard_Info()",3000);
                }else{
                close_IDCard();
                open_IDCard();
            }
            }
            var yg_list_data, bg_list_data, dsr_list_data;

            function txryxx_nextstep() {
                var b1 = save_or_update_person('原告', 'mssys');
                var b2 = save_or_update_person('被告', 'mssys');
                var b3 = save_or_update_person('第三人', 'mssys');
                if (b1 != false && b2 != false && b3 != false) {
                    if (yg_list.length == 0 || bg_list.length == 0) {
                        open_modal('原告被告至少各添加一位当事人');
                        return;
                    }
                    //跳转到下一步
                    next_step(3);
                    return;
                }
                var err = '';
                if (!b1 && b1 != -1) {
                    err += '原告信息填写不正确<br>';
                }
                if (!b2 && b2 != -1) {
                    err += '被告信息填写不正确<br>';
                }
                if (!b3 && b3 != -1) {
                    err += '第三人信息填写不正确<br>';
                }
                open_modal(err);
            }
            $(function() {
                input_list_init('#yg_table', 'mssys');
                input_list_init('#bg_table', 'mssys');
                input_list_init('#dsr_table', 'mssys');
                //从cookie获取原告、被告、第三人信息
                yg_list_data = getCookie("yg_list_data");
                bg_list_data = getCookie("bg_list_data");
                dsr_list_data = getCookie("dsr_list_data");
                if (yg_list_data != null) {
                    yg_list = JSON.parse(yg_list_data);
                }
                if (bg_list_data != null) {
                    bg_list = JSON.parse(bg_list_data);
                }
                if (dsr_list_data != null) {
                    dsr_list = JSON.parse(dsr_list_data);
                }
                /*初始化人员ID为当前列表人员ID的最大值*/
                $.each(yg_list, function(index, val) {
                    if (val[0] > ry_id) {
                        ry_id = val[0];
                    }
                });
                $.each(bg_list, function(index, val) {
                    if (val[0] > ry_id) {
                        ry_id = val[0];
                    }
                });
                $.each(dsr_list, function(index, val) {
                    if (val[0] > ry_id) {
                        ry_id = val[0];
                    }
                });
                people_list_init('原告', 'mssys');
                people_list_init('被告', 'mssys');
                people_list_init('第三人', 'mssys');
                if (yg_list.length > 0) {
                    show_person(yg_list[0], '.yg_panel');
                    $(".yg_panel .list_content_item").eq(0).addClass('active_item');
                    switch_to_update_btn('mssys');
                }
                if (bg_list.length > 0) {
                    show_person(bg_list[0], '.bg_panel');
                    $(".bg_panel .list_content_item").eq(0).addClass('active_item');
                    switch_to_update_btn('mssys');
                }
                if (dsr_list.length > 0) {
                    show_person(dsr_list[0], '.dsr_panel');
                    $(".dsr_panel .list_content_item").eq(0).addClass('active_item');
                    switch_to_update_btn('mssys');
                }
                /* 记录导航条步数的方法 */
                nav_step("last_step", 6);
            });
var i=0;
            var flag=0;
            var j=1;
            function Read_IDCard_Comm(){
                for(i=1;i<3;i++){
                    if(aaa.OpenComm(i)==1){
                        flag=1;
                        break;
                    }
                }
                if(i==3){
                    for(i=1001;i<1003;i++){
                        if(aaa.OpenComm(i)==1){
                            flag=1;
                            break;
                        }
                    }
                }
            }  
            function Read_IDCard_Info() {

                if(flag==1){
                    console.log("尝试读取身份证第"+j+"次");
                    j++;
                    if (aaa.Authen()==1){
                        if(aaa.ReadCardPath("",1)==1){
                            //读取到律所机的身份证
                            clearInterval(handler);//关闭定时
                            var card_data = {
                             "name": aaa.sName,
                             "identity_card": aaa.sIDNo,
                             "nationality": aaa.sNation,
                             "gender": aaa.sSex,
                             "country": "09_00004-1",
                             "address": aaa.sAddress,
                           }
                            // var name = aaa.sName;
                            // var id = aaa.sIDNo;
                            aaa.EndComm();
                            get_txryxx(card_data);
                            // sfytj_login(id,name);
                        } else {
                            alert("读卡错误！"+aaa.ReadCardPath("",1)); 
                            clearInterval(handler);//关闭定时
                        }
                    } 
                    // else{
                    //     alert("找卡错误,请重新放卡!");
                    // }
                } else{
                    alert("错误提示：打开端口失败");
                    clearInterval(handler);//关闭定时         
                }
            }

            function Close_Read_IDCard() {
                clearInterval(handler);//关闭定时
            }
        </script>
    </body>
</html>